<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>/N / e / w / s/ Text</title>
    <style>
        /* 1. 폰트: 둥근모 */
        @font-face {
            font-family: 'DungGeunMo';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff') format('woff');
            font-weight: normal;
            font-display: swap;
        }

        /* 2. 테마 변수 */
        :root {
            --bg-color: #000000;    /* 터미널 블랙 */
            --text-main: #A8A8A8;   /* 기본 회색 */
            --text-high: #FFFFFF;   /* 강조 흰색 */
            --text-yellow: #FFFF55; /* 노란색 */
            --text-cyan: #55FFFF;   /* 하늘색 */
            --text-green: #55FF55;  /* 초록색 */
            --text-red: #FF5555;    /* 빨간색 */
            --dim-black: #000000;
        }

        /* 기본 설정 - 전체화면 */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color); /* 전체 배경 파란색 */
            font-family: 'DungGeunMo', monospace;
            overflow: hidden;
            color: var(--text-main);
        }

        /* 모니터 컨테이너 */
        #monitor {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-color);
        }

        /* 실제 화면 영역 */
        #screen {
            flex: 1;
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: none;
            box-shadow: none;
            max-width: none;
            max-height: none;
        }

        /* 상단 상태바 */
        #status-bar {
            background-color: var(--text-main);
            color: var(--bg-color);
            padding: 4px 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            font-size: 16px;
            flex-shrink: 0;
        }

        /* 메인 컨텐츠 영역 */
        #main-view {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            font-size: 18px;
            line-height: 1.6;
            white-space: pre-wrap;
            scrollbar-width: none;
        }
        #main-view::-webkit-scrollbar { display: none; }

        /* 하단 명령 입력줄 */
        #command-line {
            background-color: var(--bg-color);
            border-top: 2px solid var(--bg-color); 
            padding: 10px 15px;
            font-size: 18px;
            color: var(--text-yellow);
            display: flex;
            align-items: center;
            min-height: 50px;
            flex-shrink: 0;
        }
        
        #cmd-input {
            background: transparent;
            border: none;
            color: var(--text-high);
            font-family: 'DungGeunMo', monospace;
            font-size: 18px;
            outline: none;
            flex: 1;
            margin-left: 10px;
            text-transform: uppercase;
        }

        /* 깜빡이는 커서 */
        .cursor {
            display: inline-block;
            width: 10px;
            height: 18px;
            background-color: var(--text-high);
            animation: blink 1s step-end infinite;
            vertical-align: middle;
            margin-left: 2px;
        }
        @keyframes blink { 50% { opacity: 0; } }

        /* 유틸리티 클래스 */
        .c-w { color: var(--text-high); }
        .c-y { color: var(--text-yellow); }
        .c-c { color: var(--text-cyan); }
        .c-g { color: var(--text-green); }
        .c-r { color: var(--text-red); }
        
        /* 링크/버튼 스타일 */
        .t-link {
            cursor: pointer;
            color: var(--text-high);
            text-decoration: none;
            padding: 2px 0;
            display: block; 
        }
        .t-link:hover, .t-link:active {
            color: var(--text-yellow);
            background-color: #000080;
        }

        /* 반응형 */
        @media (max-width: 768px) {
            #main-view { padding: 10px; font-size: 16px; }
            #command-line { font-size: 16px; padding: 8px 10px; }
            #cmd-input { font-size: 16px; }
            #status-bar { font-size: 12px; }
            .t-link { padding: 8px 0; border-bottom: 1px dashed #000080; }
        }
    </style>
</head>
<body>

<div id="monitor">
    <div id="screen">
        <!-- 상단 상태바 -->
        <div id="status-bar">
            <span>/N / e / w / s/ Text</span>
            <span id="clock">00:00:00</span>
            <span>Online</span>
        </div>

        <!-- 메인 뷰 -->
        <div id="main-view">
            <!-- 콘텐츠 로드 -->
        </div>

        <!-- 하단 명령줄 -->
        <div id="command-line">
            <span id="prompt-text">선택(번호) ></span>
            <!-- inputmode="numeric" 제거: 일반 키보드 사용 -->
            <input type="text" id="cmd-input" maxlength="10" autocomplete="off">
            <span class="cursor"></span>
        </div>
    </div>
</div>

<script>
    // --- 설정 및 상태 ---
    let currentPage = 100;
    let inputBlocked = false;
    
    // 프록시 설정
    const PROXIES = [
        "https://corsproxy.io/?",
        "https://api.allorigins.win/raw?url="
    ];

    // 뉴스 카테고리
    const NEWS_CATS = {
        // [뉴시스] 10번대
        11: { t: "뉴시스 속보", u: "https://www.newsis.com/RSS/sokbo.xml" },
        12: { t: "뉴시스 정치", u: "https://www.newsis.com/RSS/politics.xml" },
        13: { t: "뉴시스 경제", u: "https://www.newsis.com/RSS/economy.xml" },
        14: { t: "뉴시스 금융", u: "https://www.newsis.com/RSS/bank.xml" },
        15: { t: "뉴시스 산업", u: "https://www.newsis.com/RSS/industry.xml" },
        16: { t: "뉴시스 사회", u: "https://www.newsis.com/RSS/society.xml" },
        17: { t: "뉴시스 국제", u: "https://www.newsis.com/RSS/international.xml" },
        18: { t: "뉴시스 문화", u: "https://www.newsis.com/RSS/culture.xml" },
        19: { t: "뉴시스 스포츠", u: "https://www.newsis.com/RSS/sports.xml" },
        
        // [연합뉴스] 20번대
        21: { t: "연합 전체기사", u: "https://www.yna.co.kr/rss/news.xml" },
        22: { t: "연합 정치", u: "https://www.yna.co.kr/rss/politics.xml" },
        23: { t: "연합 경제", u: "https://www.yna.co.kr/rss/economy.xml" },
        24: { t: "연합 산업", u: "https://www.yna.co.kr/rss/industry.xml" },
        25: { t: "연합 사회", u: "https://www.yna.co.kr/rss/society.xml" },
        26: { t: "연합 전국", u: "https://www.yna.co.kr/rss/local.xml" },
        27: { t: "연합 국제", u: "https://www.yna.co.kr/rss/international.xml" },
        28: { t: "연합 문화", u: "https://www.yna.co.kr/rss/culture.xml" },
        29: { t: "연합 스포츠", u: "https://www.yna.co.kr/rss/sports.xml" }
    };

    // 기상청 관측소 지역별 분류 (메뉴용)
    const REGION_CITIES = {
        // 수도권
        32: { name: "서울/경기/인천", cities: ["서울", "인천", "수원", "파주", "동두천", "이천", "백령도", "강화", "양평"] },
        // 강원도
        33: { name: "강원도", cities: ["춘천", "강릉", "속초", "철원", "대관령", "원주", "영월", "태백", "인제", "홍천", "동해", "정선군"] },
        // 충청권
        34: { name: "충청/대전/세종", cities: ["대전", "세종", "청주", "충주", "추풍령", "서산", "천안", "보령", "부여", "금산", "홍성", "제천", "보은"] },
        // 전라권
        35: { name: "전라/광주", cities: ["광주", "전주", "목포", "여수", "군산", "완도", "고창", "순천", "진도(첨찰산)", "흑산도", "정읍", "남원", "임실", "장흥", "해남", "고흥"] },
        // 경상권
        36: { name: "경상/대구/부산/울산", cities: ["부산", "대구", "울산", "창원", "안동", "포항", "상주", "진주", "거창", "통영", "울릉도", "김해시", "경주시", "영천", "영덕", "의성", "봉화", "영주", "문경", "합천", "밀양", "산청", "남해", "거제", "청송군"] },
        // 제주도
        37: { name: "제주도", cities: ["제주", "서귀포", "성산", "고산"] }
    };

    // DOM 요소
    const mainView = document.getElementById('main-view');
    const cmdInput = document.getElementById('cmd-input');
    const clockSpan = document.getElementById('clock');
    const promptText = document.getElementById('prompt-text');

    // --- 시계 ---
    function updateClock() {
        const now = new Date();
        clockSpan.innerText = now.toLocaleTimeString('ko-KR', { hour12: false });
    }
    setInterval(updateClock, 1000);
    updateClock();

    // --- 초기화 ---
    function init() {
        loadPage(100);
        cmdInput.focus();
    }
    
    // --- 페이지 로더 ---
    function loadPage(pageNo) {
        if(inputBlocked) return;
        
        mainView.innerHTML = "";
        mainView.scrollTop = 0;
        cmdInput.value = "";
        currentPage = pageNo;
        promptText.innerText = `선택(번호) >`;

        // 페이지 분기
        if(pageNo === 100) renderMainMenu();
        else if(NEWS_CATS[pageNo]) fetchNewsList(pageNo);
        else if(pageNo === 30) renderWeatherMenu(); 
        else if(pageNo === 31) fetchLocalWeather(); 
        else if(pageNo >= 32 && pageNo <= 37) fetchRegionalWeather(pageNo);
        else if(pageNo === 99) renderHelp();
        else renderError("존재하지 않는 페이지입니다.");
    }

    // --- 메인 메뉴 ---
    function renderMainMenu() {
        const art = `
<span class="c-c">┌──────────────────────────────────────────────────┐</span>
<span class="c-c">│</span>  <span class="c-y">N E W S   B B S</span>                 <span class="c-g">System Ready</span>    <span class="c-c">│</span>
<span class="c-c">│</span>                                                  <span class="c-c">│</span>
<span class="c-c">│</span>  <span class="c-w">[ 뉴시스 Newsis ]</span>                               <span class="c-c">│</span>
<span class="c-c">│</span>   11.속보 12.정치 13.경제 14.금융 15.산업        <span class="c-c">│</span>
<span class="c-c">│</span>   16.사회 17.국제 18.문화 19.스포츠              <span class="c-c">│</span>
<span class="c-c">│</span>                                                  <span class="c-c">│</span>
<span class="c-c">│</span>  <span class="c-w">[ 연합뉴스 Yonhap ]</span> (기사본문 지원)             <span class="c-c">│</span>
<span class="c-c">│</span>   21.전체 22.정치 23.경제 24.산업 25.사회        <span class="c-c">│</span>
<span class="c-c">│</span>   26.전국 27.국제 28.문화 29.스포츠              <span class="c-c">│</span>
<span class="c-c">│</span>                                                  <span class="c-c">│</span>
<span class="c-c">│</span>  <span class="c-w">[ 날씨 Weather ]</span>                                <span class="c-c">│</span>
<span class="c-c">│</span>   30. 날씨 홈 (지역별 상세 조회)                 <span class="c-c">│</span>
<span class="c-c">│</span>   31. <span class="c-y">내 위치 날씨</span>                               <span class="c-c">│</span>
<span class="c-c">│</span>                                                  <span class="c-c">│</span>
<span class="c-c">│</span>   99. 도움말              X.  접속 종료          <span class="c-c">│</span>
<span class="c-c">└──────────────────────────────────────────────────┘</span>

<span class="c-w"> * 번호를 입력하거나 화면을 터치하세요.</span>
`;
        mainView.innerHTML = art;
    }

    // --- 뉴스 목록 ---
    async function fetchNewsList(catId) {
        renderLoading();
        const cat = NEWS_CATS[catId];
        let xmlText = null;

        for (const proxy of PROXIES) {
            try {
                const res = await fetch(proxy + encodeURIComponent(cat.u));
                if (res.ok) {
                    xmlText = await res.text();
                    break;
                }
            } catch (e) { console.warn("Proxy fail"); }
        }

        if (!xmlText) { renderError("데이터 수신 실패.\n잠시 후 다시 시도하세요."); return; }

        try {
            const parser = new DOMParser();
            const xml = parser.parseFromString(xmlText, "text/xml");
            const items = xml.querySelectorAll("item");
            
            window.currentNewsItems = [];
            items.forEach(node => {
                window.currentNewsItems.push({
                    title: node.querySelector("title")?.textContent || "",
                    desc: node.querySelector("description")?.textContent || "",
                    date: node.querySelector("pubDate")?.textContent || "",
                    link: node.querySelector("link")?.textContent || "",
                    isYonhap: (catId >= 20 && catId < 30)
                });
            });

            let output = `<span class="c-y">■ ${cat.t} ■</span>\n\n`;
            
            window.currentNewsItems.slice(0, 15).forEach((item, idx) => {
                let title = item.title;
                title = title.replace(/&quot;/g, '"').replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>');
                if(title.length > 22) title = title.substring(0, 21) + "..";
                
                let timeStr = "";
                try {
                    const d = new Date(item.date);
                    const now = new Date();
                    if(d.toDateString() === now.toDateString()) {
                        timeStr = d.getHours().toString().padStart(2,'0') + ":" + d.getMinutes().toString().padStart(2,'0');
                    } else {
                        timeStr = (d.getMonth()+1) + "/" + d.getDate();
                    }
                } catch(e){}

                const num = (idx + 1).toString().padStart(2, '0');
                output += `<div class="t-link" onclick="showNewsDetail(${idx})"><span class="c-g">${num}</span> ${title} <span class="c-c" style="float:right">${timeStr}</span></div>`;
            });

            output += `\n<span class="c-w">[M:메뉴] [번호:읽기]</span>`;
            mainView.innerHTML = output;
            promptText.innerText = "선택(기사번호) >";
        } catch(e) {
            renderError("RSS 파싱 오류");
        }
    }

    // --- 뉴스 상세 ---
    window.showNewsDetail = async function(idx) {
        const item = window.currentNewsItems[idx];
        if(!item) return;

        let cleanDesc = item.desc.replace(/<[^>]*>/g, "").trim();
        
        let header = `
<span class="c-c">┌──────────────────────────────────────────────────┐</span>
<span class="c-y"> ${item.title}</span>
<span class="c-c">└──────────────────────────────────────────────────┘</span>
<span class="c-g">작성일: ${item.date}</span>
`;
        
        let loadingMsg = "";
        if(item.isYonhap) {
            loadingMsg = `\n<span class="c-c blink">>> 본문 전체를 불러오는 중입니다...</span>\n`;
        }

        let body = `\n${cleanDesc}\n`;
        let footer = `\n<span class="c-w">====================================================</span>
<span class="c-c">[Enter:목록] [M:메뉴]</span>`;

        mainView.innerHTML = header + loadingMsg + body + footer;
        currentPage = 'READING';
        promptText.innerText = "명령(Enter) >";

        if(item.isYonhap) {
            try {
                let fullText = "";
                let fetched = false;

                for (const proxy of PROXIES) {
                    try {
                        const res = await fetch(proxy + encodeURIComponent(item.link));
                        if(res.ok) {
                            const html = await res.text();
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(html, "text/html");
                            
                            const article = doc.querySelector('.story-news') || doc.querySelector('#articleWrap') || doc.querySelector('.article-story');
                            if(article) { fullText = article.innerText; fetched = true; }
                            
                            if(fetched) break;
                        }
                    } catch(e) {}
                }

                if(fetched && fullText.length > 50) {
                    fullText = fullText.replace(/\n\s*\n/g, '\n\n');
                    mainView.innerHTML = header + `\n<span class="c-y">[전문]</span>\n` + fullText + footer;
                } else {
                    mainView.innerHTML = header + `\n<span class="c-r">(본문 수신 불가 - 요약본 표시)</span>\n` + body + footer;
                }
            } catch(e) { }
        }
    }

    // --- 기상청 데이터 파싱 ---
    async function getKmaData() {
        const url = "https://www.kma.go.kr/XML/weather/sfc_web_map.xml";
        let xmlText = null;
        for (const proxy of PROXIES) {
            try {
                const res = await fetch(proxy + encodeURIComponent(url));
                if (res.ok) { xmlText = await res.text(); break; }
            } catch (e) {}
        }
        if(!xmlText) throw new Error("Weather Load Failed");
        
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "text/xml");
        return {
            year: xml.querySelector("weather").getAttribute("year"),
            month: xml.querySelector("weather").getAttribute("month"),
            day: xml.querySelector("weather").getAttribute("day"),
            hour: xml.querySelector("weather").getAttribute("hour"),
            locals: xml.querySelectorAll("local")
        };
    }

    // --- 날씨 메인 (30번) ---
    function renderWeatherMenu() {
        const art = `
<span class="c-y">■ 날씨 정보 서비스 ■</span>

 31. <span class="c-g">내 위치 날씨 확인 (GPS)</span>

 [지역별 상세 날씨 (시/군/구)]
 --------------------------------------
 <span class="t-link" onclick="loadPage(32)">32. 서울 / 경기 / 인천</span>
 <span class="t-link" onclick="loadPage(33)">33. 강원도 (영서/영동)</span>
 <span class="t-link" onclick="loadPage(34)">34. 충청 / 대전 / 세종</span>
 <span class="t-link" onclick="loadPage(35)">35. 전라 / 광주</span>
 <span class="t-link" onclick="loadPage(36)">36. 경상 / 대구 / 부산 / 울산</span>
 <span class="t-link" onclick="loadPage(37)">37. 제주도</span>
 --------------------------------------

<span class="c-w">[M] 메인 메뉴로 돌아가기</span>
`;
        mainView.innerHTML = art;
        promptText.innerText = "선택(번호) >";
    }

    // --- 지역별 상세 날씨 (32~37번) ---
    async function fetchRegionalWeather(pageNo) {
        renderLoading();
        try {
            const data = await getKmaData();
            const items = data.locals;
            const regionInfo = REGION_CITIES[pageNo];
            
            if(!regionInfo) { renderError("지역 정보 오류"); return; }

            let output = `<span class="c-y">■ ${regionInfo.name} 지역 날씨 ■</span>\n`;
            output += `<span class="c-g">발표: ${data.year}.${data.month}.${data.day} ${data.hour}시</span>\n\n`;
            
            output += `<div style="display:grid; grid-template-columns: 1fr 1fr; gap: 8px;">`;
            
            regionInfo.cities.forEach(city => {
                let info = { temp: "--", desc: "정보없음" };
                for(let i=0; i<items.length; i++) {
                    if(items[i].textContent === city) {
                        info.temp = items[i].getAttribute("ta");
                        info.desc = items[i].getAttribute("desc");
                        break;
                    }
                }
                output += `<div><span class="c-c">${city}</span> <span class="c-w">${info.desc}</span> <span class="c-r">${info.temp}℃</span></div>`;
            });
            output += `</div>`;
            
            output += `\n<span class="c-g">[30:날씨홈] [M:메인]</span>`;
            
            mainView.innerHTML = output;
            promptText.innerText = "명령(30/M) >";
        } catch(e) {
            renderError("날씨 정보 수신 실패");
        }
    }

    // --- 내 위치 날씨 (31) ---
    function fetchLocalWeather() {
        if(!navigator.geolocation) {
            renderError("브라우저가 위치 정보를 지원하지 않습니다.");
            return;
        }
        
        mainView.innerHTML = `<span class="c-c blink">위성 신호 수신중... (GPS)</span>`;
        
        navigator.geolocation.getCurrentPosition(async (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            
            try {
                const data = await getKmaData();
                const items = data.locals;
                
                // 검색 대상 도시 전체 목록 (좌표 포함)
                // REGION_CITIES에 있는 거의 모든 관측소 좌표 등록
                const ALL_COORD_CITIES = [
                    // 서울/경기/인천
                    {n:"서울",la:37.57,lo:126.97}, {n:"인천",la:37.48,lo:126.62}, {n:"수원",la:37.26,lo:126.98},
                    {n:"파주",la:37.88,lo:126.78}, {n:"동두천",la:37.90,lo:127.06}, {n:"이천",la:37.28,lo:127.44},
                    {n:"백령도",la:37.97,lo:124.63}, {n:"강화",la:37.75,lo:126.48}, {n:"양평",la:37.49,lo:127.49},
                    // 강원
                    {n:"춘천",la:37.90,lo:127.74}, {n:"강릉",la:37.75,lo:128.89}, {n:"속초",la:38.21,lo:128.56},
                    {n:"철원",la:38.15,lo:127.30}, {n:"대관령",la:37.68,lo:128.76}, {n:"원주",la:37.34,lo:127.95},
                    {n:"영월",la:37.18,lo:128.46}, {n:"태백",la:37.17,lo:128.99}, {n:"인제",la:38.06,lo:128.17},
                    {n:"홍천",la:37.68,lo:127.88}, {n:"동해",la:37.52,lo:129.11}, {n:"정선군",la:37.38,lo:128.66},
                    // 충청
                    {n:"대전",la:36.37,lo:127.37}, {n:"세종",la:36.48,lo:127.29}, {n:"청주",la:36.64,lo:127.44},
                    {n:"충주",la:36.97,lo:127.95}, {n:"추풍령",la:36.22,lo:127.99}, {n:"서산",la:36.77,lo:126.49},
                    {n:"천안",la:36.81,lo:127.11}, {n:"보령",la:36.33,lo:126.56}, {n:"부여",la:36.27,lo:126.91},
                    {n:"금산",la:36.11,lo:127.48}, {n:"홍성",la:36.60,lo:126.66}, {n:"제천",la:37.13,lo:128.19},
                    {n:"보은",la:36.49,lo:127.73},
                    // 전라
                    {n:"광주",la:35.17,lo:126.85}, {n:"전주",la:35.84,lo:127.13}, {n:"목포",la:34.81,lo:126.39},
                    {n:"여수",la:34.76,lo:127.66}, {n:"군산",la:35.99,lo:126.72}, {n:"완도",la:34.31,lo:126.71},
                    {n:"고창",la:35.43,lo:126.69}, {n:"순천",la:35.03,lo:127.38}, {n:"진도(첨찰산)",la:34.47,lo:126.26},
                    {n:"흑산도",la:34.68,lo:125.43}, {n:"정읍",la:35.56,lo:126.85}, {n:"남원",la:35.42,lo:127.39},
                    {n:"임실",la:35.61,lo:127.28}, {n:"장흥",la:34.68,lo:126.92}, {n:"해남",la:34.55,lo:126.57},
                    {n:"고흥",la:34.61,lo:127.28},
                    // 경상
                    {n:"부산",la:35.10,lo:129.03}, {n:"대구",la:35.88,lo:128.62}, {n:"울산",la:35.56,lo:129.31},
                    {n:"창원",la:35.23,lo:128.68}, {n:"안동",la:36.56,lo:128.72}, {n:"포항",la:36.03,lo:129.38},
                    {n:"상주",la:36.41,lo:128.16}, {n:"진주",la:35.19,lo:128.08}, {n:"거창",la:35.67,lo:127.91},
                    {n:"통영",la:34.85,lo:128.43}, {n:"울릉도",la:37.48,lo:130.91}, {n:"김해시",la:35.22,lo:128.89},
                    {n:"경주시",la:35.83,lo:129.20}, {n:"영천",la:35.97,lo:128.94}, {n:"영덕",la:36.40,lo:129.36},
                    {n:"의성",la:36.35,lo:128.69}, {n:"봉화",la:36.89,lo:128.73}, {n:"영주",la:36.87,lo:128.51},
                    {n:"문경",la:36.62,lo:128.14}, {n:"합천",la:35.57,lo:128.17}, {n:"밀양",la:35.49,lo:128.74},
                    {n:"산청",la:35.41,lo:127.87}, {n:"남해",la:34.82,lo:127.92}, {n:"거제",la:34.88,lo:128.62},
                    {n:"청송군",la:36.43,lo:129.05},
                    // 제주
                    {n:"제주",la:33.51,lo:126.52}, {n:"서귀포",la:33.25,lo:126.56}, {n:"성산",la:33.39,lo:126.88},
                    {n:"고산",la:33.29,lo:126.16}
                ];

                let nearest = null;
                let minDist = Infinity;
                
                // 전체 관측소 중 가장 가까운 곳 탐색
                ALL_COORD_CITIES.forEach(city => {
                    const dist = Math.pow(city.la - lat, 2) + Math.pow(city.lo - lon, 2);
                    if(dist < minDist) {
                        minDist = dist;
                        nearest = city;
                    }
                });
                
                let weatherInfo = { temp: "--", desc: "정보없음" };
                if(nearest) {
                    for(let i=0; i<items.length; i++) {
                        if(items[i].textContent === nearest.n) {
                            weatherInfo.temp = items[i].getAttribute("ta");
                            weatherInfo.desc = items[i].getAttribute("desc");
                            break;
                        }
                    }
                }

                let output = `
<span class="c-y">■ 내 위치 날씨 정보 ■</span>

<span class="c-w">현재 위치(GPS)</span>: 위도 ${lat.toFixed(2)}, 경도 ${lon.toFixed(2)}
<span class="c-w">인접 관측소</span>  : <span class="c-c">${nearest ? nearest.n : '알수없음'}</span>

<span class="c-c">┌──────────────────────────┐</span>
   기  온 : <span class="c-r" style="font-size:1.5em">${weatherInfo.temp}℃</span>
   상  태 : <span class="c-w" style="font-size:1.2em">${weatherInfo.desc}</span>
<span class="c-c">└──────────────────────────┘</span>

<span class="c-g">발표: ${data.year}.${data.month}.${data.day} ${data.hour}:00</span>
<span class="c-w">[R:새로고침] [30:날씨홈] [M:메인]</span>
`;
                mainView.innerHTML = output;
                promptText.innerText = "명령(M) >";
                
            } catch(e) {
                renderError("날씨 데이터 처리 실패");
            }
        }, (err) => {
            renderError("GPS 위치 권한을 승인해주세요.");
        });
    }

    // --- 유틸리티 ---
    function renderLoading() {
        mainView.innerHTML = `<span class="c-c blink">데이터를 불러오는 중입니다...</span>`;
    }

    function renderError(msg) {
        mainView.innerHTML = `<span class="c-r">!!! ERROR !!!</span>\n\n${msg}\n\n<span class="c-w">[M] 키를 눌러 메뉴로 복귀하세요.</span>`;
        currentPage = 'ERROR';
    }

    function renderHelp() {
        mainView.innerHTML = `
<span class="c-y">■ 도움말 ■</span>

1. 원하는 메뉴의 번호를 입력 후 Enter를 누르세요.
2. 모바일에서는 화면의 항목을 터치해도 됩니다.
3. [31]번 내 위치 날씨는 GPS 권한이 필요합니다.
4. 연합뉴스(20번대), 날씨(30번대)를 제공합니다.

<span class="c-g">[M] 메인 메뉴로 돌아가기</span>
`;
    }

    // --- 입력 처리 ---
    cmdInput.addEventListener('keydown', function(e) {
        if(e.key === 'Enter') {
            const cmd = this.value.trim().toUpperCase();
            this.value = "";
            processCommand(cmd);
        }
    });

    // 화면 아무데나 누르면 입력창 포커스 (모바일 키보드 활성화)
    document.body.addEventListener('click', (e) => {
        // 링크 클릭이 아닐 때만 포커스
        if(!e.target.closest('.t-link')) {
            cmdInput.focus();
        }
    });

    function processCommand(cmd) {
        if(cmd === 'M' || cmd === 'MENU' || cmd === '100') {
            loadPage(100);
            return;
        }
        if(cmd === 'X' || cmd === 'Q') {
            alert("접속을 종료합니다.");
            window.close();
            return;
        }
        if(cmd === 'R' && currentPage === 31) {
            fetchLocalWeather();
            return;
        }

        if(currentPage === 'READING') {
            loadPage(100); 
            return;
        }
        
        // 숫자 입력 처리
        const num = parseInt(cmd);
        if(!isNaN(num)) {
            // 기사 목록 화면에서 1~45번 입력 시 상세보기
            if((currentPage >= 10 && currentPage <= 29) && (num >= 1 && num <= 45)) {
                showNewsDetail(num - 1);
            } else {
                // 그 외에는 페이지 이동
                loadPage(num);
            }
        }
    }

    // 시작
    init();

</script>
</body>
</html>
